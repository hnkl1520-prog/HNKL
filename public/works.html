<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Works</title>
    
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    
    <!-- [연결] 공통 스타일 (common.css) -->
    <link rel="stylesheet" href="common.css">
    
    <!-- GSAP (필수 애니메이션 라이브러리) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>

    <!-- 헤더 (ID: global-header 필수) -->
    <header id="global-header" class="at-top">
        <div class="header-inner">
            <div class="header-left">
                <!-- [수정] 로고 경로: assets/logo.svg -->
                <a href="index.html" class="header-logo hover-trigger">
                    <img src="assets/logo.svg" alt="HANUK Logo">
                </a>
                <nav class="header-nav">
                    <a href="about.html" class="nav-link hover-trigger">About</a>
                    <a href="#" class="nav-link active hover-trigger">Works</a>
                </nav>
            </div>
            <div class="header-right">
                <button class="lang-btn active hover-trigger">KR</button>
                <span class="lang-divider">/</span>
                <button class="lang-btn hover-trigger">EN</button>
            </div>
        </div>
    </header>

    <!-- 페이지 전환 커튼 -->
    <div id="page-entry-curtain"></div>

    <!-- 커스텀 젤리 커서 (common.js가 이 ID를 찾아서 움직입니다) -->
    <div id="cursor-bg-layer">
        <div id="cursor-circle"></div>
    </div>
    <div id="cursor-text-layer">
        <span id="cursor-text"></span>
    </div>

    <!-- 메인 컨텐츠 -->
    <main>
        <div class="container">
            <!-- 갤러리 그리드 -->
            <div id="works-grid" class="works-grid"></div>
        </div>
    </main>

    <!-- Floating Dock -->
    <nav class="floating-dock">
        <!-- 움직이는 배경 (쫀득이) -->
        <div class="dock-pill" id="dock-pill"></div>
        
        <!-- [수정] 아이콘 경로: public/assets -> assets/ -->
        <button onclick="switchCategory('projects', this)" class="dock-btn active hover-trigger" id="btn-projects">
            <img src="assets/Projects.svg" class="dock-icon" alt="Projects Icon">
            <span>Projects</span>
        </button>
        
        <button onclick="switchCategory('labs', this)" class="dock-btn hover-trigger" id="btn-labs">
            <img src="assets/Labs.svg" class="dock-icon" alt="Labs Icon">
            <span>Labs</span>
        </button>
    </nav>

    <!-- [연결] 공통 스크립트 (커서, 헤더 스크롤 로직은 여기서 처리) -->
    <script src="common.js"></script>

    <!-- 페이지 전용 스크립트 (데이터, 렌더링, 독 인터랙션) -->
    <script>
        // ===============================================
        // DATA
        // ===============================================
        // [수정] 각 데이터에 'url' 속성을 추가하여 이동할 페이지를 지정했습니다.
        const projectsData = [
            { title: "SmartThings: Connected Experience", cat: "UX/UI Design", img: "project_01.png", url: "404.html" },
            { title: "Samsung Global Retail System", cat: "Service Design", img: "project_02.png", url: "404.html" },
            { title: "Future Mobility Dashboard", cat: "Automotive UX", img: "project_03.png", url: "404.html" },
            { title: "Generative AI Campaign", cat: "Web Promotion", img: "project_04.png", url: "404.html" },
            { title: "Financial App Renewal", cat: "App Design", img: "project_05.png", url: "404.html" },
            { title: "Sustainable Packaging", cat: "Branding", img: "project_06.png", url: "404.html" }
        ];

        const labsData = [
            // [요청 반영] 1~3번 항목을 works/Labs/Untitled_XX.html 로 연결
            { title: "Untitled_01", cat: "Creative Coding", img: "lab_01.png", url: "works/Labs/Untitled_01.html" },
            { title: "Untitled_02", cat: "Motion Graphic", img: "lab_02.png", url: "works/Labs/Untitled_02.html" },
            { title: "Untitled_03f", cat: "Spark AR", img: "lab_03.png", url: "works/Labs/Untitled_03.html" },
            // 나머지는 아직 없으므로 404 처리 (필요시 수정)
            { title: "Procedural Texture Gen", cat: "WebGL", img: "lab_04.png", url: "404.html" },
            { title: "Interactive Cube", cat: "3D Interaction", img: "lab_05.png", url: "404.html" }
        ];

        let currentCategory = 'projects';

        // ===============================================
        // INITIALIZATION
        // ===============================================
        window.addEventListener('load', () => {
            // 1. 페이지 로드 커튼 효과
            const curtain = document.getElementById('page-entry-curtain');
            if(curtain) {
                gsap.to(curtain, {
                    top: "100%", duration: 0.8, ease: "power3.inOut", delay: 0.2,
                    onComplete: () => { curtain.style.display = 'none'; }
                });
            }

            // 2. 초기 데이터 렌더링
            renderWorks('projects');
            
            // 3. 독(Dock) 초기 위치 설정
            const initialBtn = document.getElementById('btn-projects');
            if(initialBtn) movePill(initialBtn, true); 
        });


        // ===============================================
        // GALLERY LOGIC
        // ===============================================

        function renderWorks(category) {
            const grid = document.getElementById('works-grid');
            const data = category === 'projects' ? projectsData : labsData;
            
            grid.innerHTML = ''; 

            data.forEach((item, index) => {
                // 썸네일 경로: assets/works/thumb
                const imgSrc = `assets/works/thumb/${item.img}`;
                
                // 링크 설정: 데이터에 url이 있으면 사용, 없으면 404.html
                const linkUrl = item.url ? item.url : '404.html';
                
                const html = `
                    <article class="work-item hover-trigger" onclick="location.href='${linkUrl}'">
                        <div class="thumb-wrapper">
                            <img src="${imgSrc}" class="thumb-img" alt="${item.title}" onerror="this.src='https://via.placeholder.com/600x600/e0e0e0/888?text=No+Image'">
                            <div class="reveal-curtain"></div>
                        </div>
                        <div class="work-meta">
                            <div class="work-cat">${item.cat}</div>
                            <h3 class="work-title">${item.title}</h3>
                        </div>
                    </article>
                `;
                grid.insertAdjacentHTML('beforeend', html);
            });

            animateItems();
        }

        function animateItems() {
            const items = document.querySelectorAll('.work-item');
            const directions = ['top', 'bottom', 'left', 'right'];

            items.forEach((item, i) => {
                gsap.fromTo(item, 
                    { opacity: 0, y: 30 },
                    { opacity: 1, y: 0, duration: 0.6, ease: "power2.out", delay: i * 0.05 }
                );

                const curtain = item.querySelector('.reveal-curtain');
                const dir = directions[Math.floor(Math.random() * 4)];
                
                curtain.style.top = '0'; curtain.style.left = '0'; 
                curtain.style.right = 'auto'; curtain.style.bottom = 'auto';
                curtain.style.width = '100%'; curtain.style.height = '100%';

                let targetProps = {};

                switch(dir) {
                    case 'top':    targetProps = { height: "0%" }; break;
                    case 'bottom': curtain.style.top = 'auto'; curtain.style.bottom = '0'; targetProps = { height: "0%" }; break;
                    case 'left':   targetProps = { width: "0%" }; break;
                    case 'right':  curtain.style.left = 'auto'; curtain.style.right = '0'; targetProps = { width: "0%" }; break;
                }

                gsap.to(curtain, {
                    ...targetProps,
                    duration: 0.8,
                    ease: "power3.inOut",
                    delay: 0.1 + (i * 0.05)
                });
            });
        }

        function switchCategory(category, clickedBtn) {
            if (currentCategory === category) return;
            currentCategory = category;

            // 버튼 상태 업데이트 & 알약 이동
            document.querySelectorAll('.dock-btn').forEach(btn => btn.classList.remove('active'));
            clickedBtn.classList.add('active');
            movePill(clickedBtn);

            // 다크모드/라이트모드 전환 (Labs 클릭 시 다크모드)
            if (category === 'labs') {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }

            // 기존 목록 퇴장 후 새 목록 로드
            const oldItems = document.querySelectorAll('.work-item');
            gsap.to(oldItems, {
                opacity: 0, y: -20, duration: 0.3, stagger: 0.02,
                onComplete: () => {
                    renderWorks(category);
                }
            });
        }

        function movePill(targetBtn, immediate = false) {
            const pill = document.getElementById('dock-pill');
            if(!pill) return;
            
            const x = targetBtn.offsetLeft;
            const w = targetBtn.offsetWidth;
            
            if (immediate) {
                gsap.set(pill, { left: x, width: w });
            } else {
                gsap.to(pill, {
                    left: x,
                    width: w,
                    duration: 1.0, 
                    ease: "elastic.out(1, 0.4)" 
                });
            }
        }
    </script>
</body>
</html>